{% extends "base.html" %}
{% block title %}
    website checker
{% endblock %}

{% block content %}
    <section class="example">
    <div id="gridlydashboard" class="gridly">
        <div id="website1" class="brick large site-down"></div>
        <div class="brick large site-up"></div>
        <div class="brick large site-incorrect"></div>
        <div class="brick large site-up"></div>
    </div>
    </section>
{% endblock %}

{% block js %}
    <script type="text/javascript">
$(document).ready(function() {

    // Dashboard setup - create a brick for each website and start gridly
    var websites = {{ urls|safe }};

    var dashboard = document.getElementById("gridlydashboard");
    buildGrid(websites, dashboard, document);
    // start gridly
    $('.gridly').gridly({
        base: 60, // px
        gutter: 20, // px
        columns: 16
    });

    var sample_period = {{ sample_period }};

    $.getJSON(
            "{{ url_for('siteup.run_checks') }}", function (job_id) {
               var inner_intervalId = setInterval(function(job_id){
                   // every 200ms check job's status
                   $.getJSON(
                       "{{ url_for('siteup.get_status', job_id=job_id) }}", function (data) {
                           if (data["status"] === "SUCCESS") {
                               clearInterval(inner_intervalId);
                               // job succeeded, get results and update bricks accordingly
                               $.getJSON(
                                   "{{ url_for('siteup.get_results', job_id=job_id) }}", function (results) {
                                       updateBricks(results, dashboard);
                                   });
                           } else if (data["status"] === "FAILURE") {
                                clearInterval(inner_intervalId);
                                console.debug("FAILURE");
                           }
                           // else: PENDING, need to wait more
                       });
               }, 200);
        });
    });
    </script>
{% endblock %}
